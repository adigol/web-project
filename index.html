<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Blend &mdash; Free HTML5 Bootstrap Website Template by FreeHTML5.co</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Free HTML5 Website Template by FreeHTML5.co" />
    <meta name="keywords" content="free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
    <meta name="author" content="FreeHTML5.co" />







    <!--testing...
    //////////////////////////////////////////////////////

    FREE HTML5 TEMPLATE
    DESIGNED & DEVELOPED by FreeHTML5.co

    Website: 		http://freehtml5.co/
    Email: 			info@freehtml5.co
    Twitter: 		http://twitter.com/fh5co
    Facebook: 		https://www.facebook.com/fh5co

    //////////////////////////////////////////////////////
    -->
    <!-- Facebook and Twitter integration -->
    <meta property="og:title" content="" />
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <meta property="og:site_name" content="" />
    <meta property="og:description" content="" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="" />
    <meta name="twitter:url" content="" />
    <meta name="twitter:card" content="" />
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="shortcut icon" href="favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,600,400italic,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

    <!-- Animate.css -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- Icomoon Icon Fonts-->
    <link rel="stylesheet" href="css/icomoon.css">
    <!-- Bootstrap  -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <!-- Theme style  -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Modernizr JS -->
    <script src="js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    <link href="css/bootstrap.fd.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body>



    <div id="fh5co-page">
        <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
        <aside id="fh5co-aside" role="complementary" class="border js-fullheight">
            <h1 id="fh5co-logo"><a href="index.html"><img src="images/logo-colored.png" alt="Free HTML5 Bootstrap Website Template"></a></h1>
            <nav id="fh5co-main-menu" role="navigation">
                <ul>
                    <li class="fh5co-active"><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a id="uploadImage">Upload an image</a></li>
                </ul>
                <div id="signIn">
                    <div>
                        <input id="email" type="text" placeholder="Email...">
                    </div>
                    <div>
                        <input id="password" type="password" placeholder="Password...">
                    </div>
                    <div>
                        <button id="sign-up" onclick="signUp();">Sign up</button>

                        <button id="sign-in" onclick="signIn();">Sign In</button>

                    </div>
                </div>
                <div id="logged-in" value="hide">
                    <div id="hello"></div>
                    <button id="sign-out" onclick="signOut();">Sign Out</button>
                </div>

            </nav>
            <div class="fh5co-footer">
                <p>
                    <small>
                        &copy; 2016 Blend Free HTML5. All Rights Reserved.
                        <span>Designed by <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a> </span>
                        <span>Demo Images: <a href="http://pexels.com/" target="_blank">Pexels</a></span>
                    </small>
                </p>
                <ul>
                    <li><a href="#"><i class="icon-facebook"></i></a></li>
                    <li><a href="#"><i class="icon-twitter"></i></a></li>
                    <li><a href="#"><i class="icon-instagram"></i></a></li>
                    <li><a href="#"><i class="icon-linkedin"></i></a></li>
                </ul>
            </div>
        </aside>



        <div id="fh5co-main">
            <div id="gallery">
                <h1 class="container fh5co-heading animate-box" data-animate-effect="fadeInLeft">step 1: choose photos</h1>
                <div class="fh5co-gallery"></div>
                <div class="w3-padding w3-xlarge w3 container">
                    <button class="fa fa-trash btn" onclick="Delete()"></button>
                    <button onclick="showNext()" class="btn">Next</button>
                </div>
            </div>




            <div class="center" id="video" hidden>
                <video width="320" height="240" poster="" controls>
                    <source src="shlomo.mp3" type="audio/mpeg">
                </video>
                <button onclick="showPrev2()" class="btn">Back</button>
            </div>

            <div id="create" class="container" hidden>
                <h1 class="fh5co-heading animate-box" data-animate-effect="fadeInLeft">Step 2: choose a song file</h1>
                <form name="JSONUploadForm">
                    <input type="file" name="file" accept=".mp3" /> <br />
                </form>
                <button onclick="showPrev()" class="btn">Back</button>
                <button onclick="Create()" class="btn">Create your video</button>
            </div>

            <!--https://en.code-bude.net/2013/04/17/how-to-create-video-files-in-c-from-single-images/-->


            <div class="fh5co-narrow-content">
                <h2 class="fh5co-heading animate-box" data-animate-effect="fadeInLeft">Services</h2>
                <div class="row">
                    <div class="col-md-6">
                        <div class="fh5co-feature animate-box" data-animate-effect="fadeInLeft">
                            <div class="fh5co-icon">
                                <i class="icon-strategy"></i>
                            </div>
                            <div class="fh5co-text">
                                <h3>Strategy</h3>
                                <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="fh5co-feature animate-box" data-animate-effect="fadeInLeft">
                            <div class="fh5co-icon">
                                <i class="icon-telescope"></i>
                            </div>
                            <div class="fh5co-text">
                                <h3>Explore</h3>
                                <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="fh5co-feature animate-box" data-animate-effect="fadeInLeft">
                            <div class="fh5co-icon">
                                <i class="icon-circle-compass"></i>
                            </div>
                            <div class="fh5co-text">
                                <h3>Direction</h3>
                                <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="fh5co-feature animate-box" data-animate-effect="fadeInLeft">
                            <div class="fh5co-icon">
                                <i class="icon-tools-2"></i>
                            </div>
                            <div class="fh5co-text">
                                <h3>Expertise</h3>
                                <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="fh5co-testimonial">
                <div class="fh5co-narrow-content">
                    <div class="owl-carousel-fullwidth animate-box" data-animate-effect="fadeInLeft">
                        <div class="item">
                            <figure>
                                <img src="images/testimonial_person2.jpg" alt="Free HTML5 Bootstrap Template">
                            </figure>
                            <p class="text-center quote">&ldquo;Design must be functional and functionality must be translated into visual aesthetics, without any reliance on gimmicks that have to be explained. &rdquo; <cite class="author">&mdash; Ferdinand A. Porsche</cite></p>
                        </div>
                        <div class="item">
                            <figure>
                                <img src="images/testimonial_person3.jpg" alt="Free HTML5 Bootstrap Template">
                            </figure>
                            <p class="text-center quote">&ldquo;Creativity is just connecting things. When you ask creative people how they did something, they feel a little guilty because they didn’t really do it, they just saw something. It seemed obvious to them after a while. &rdquo;<cite class="author">&mdash; Steve Jobs</cite></p>
                        </div>
                        <div class="item">
                            <figure>
                                <img src="images/testimonial_person4.jpg" alt="Free HTML5 Bootstrap Template">
                            </figure>
                            <p class="text-center quote">&ldquo;I think design would be better if designers were much more skeptical about its applications. If you believe in the potency of your craft, where you choose to dole it out is not something to take lightly. &rdquo;<cite class="author">&mdash; Frank Chimero</cite></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="fh5co-counters" style="background-image: url(images/hero.jpg);" data-stellar-background-ratio="0.5" id="counter-animate">
                <div class="fh5co-narrow-content animate-box">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <span class="fh5co-counter js-counter" data-from="0" data-to="67" data-speed="5000" data-refresh-interval="50"></span>
                            <span class="fh5co-counter-label">Client</span>
                        </div>
                        <div class="col-md-4 text-center">
                            <span class="fh5co-counter js-counter" data-from="0" data-to="130" data-speed="5000" data-refresh-interval="50"></span>
                            <span class="fh5co-counter-label">Photos</span>
                        </div>
                        <div class="col-md-4 text-center">
                            <span class="fh5co-counter js-counter" data-from="0" data-to="27232" data-speed="5000" data-refresh-interval="50"></span>
                            <span class="fh5co-counter-label">Pixels</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="fh5co-narrow-content">
                <div class="row">
                    <div class="col-md-4 animate-box" data-animate-effect="fadeInLeft">
                        <h1 class="fh5co-heading-colored">Get in touch</h1>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 animate-box" data-animate-effect="fadeInLeft">
                        <p class="fh5co-lead">Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
                        <p><a href="#" class="btn btn-primary btn-outline">Learn More</a></p>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- jQuery -->
    <script src="js/jquery.min.js"></script>
    <!-- jQuery Easing -->
    <script src="js/jquery.easing.1.3.js"></script>
    <!-- Bootstrap -->
    <script src="js/bootstrap.min.js"></script>

    <script src="js/bootstrap.fd.js"></script>
    <!-- Carousel -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- Stellar -->
    <script src="js/jquery.stellar.min.js"></script>
    <!-- Waypoints -->
    <script src="js/jquery.waypoints.min.js"></script>
    <!-- Counters -->
    <script src="js/jquery.countTo.js"></script>


    <!-- MAIN JS -->
    <script src="js/main.js"></script>



    <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
    <script>

        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyAS_xtVWEhaCdHBjZ-GmfLSsj91TnvYxrA",
            authDomain: "album-477f3.firebaseapp.com",
            databaseURL: "https://album-477f3.firebaseio.com",
            projectId: "album-477f3",
            storageBucket: "gs://album-477f3.appspot.com",
            messagingSenderId: "395950448572"
        };
        firebase.initializeApp(config);

        function guid() {
            function s4() {
                return Math.floor((1 + Math.random()) * 0x10000)
                    .toString(16)
                    .substring(1);
            }
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
                s4() + '-' + s4() + s4() + s4();
        }

        function loadList() {
            $(".fh5co-gallery").html('');
            let imagesRef = firebase.database().ref().child(firebase.auth().currentUser.uid).child("images");
            let i = 0;
            imagesRef.once('value', function (snapshot) {
                snapshot.forEach(function (childSnapshot) {
                    let childData = childSnapshot.val();
                    let imageRef = firebase.storage().ref().child(childData.fileName);
                    imageRef.getDownloadURL().then(function (url) {
                        var xhr = new XMLHttpRequest();
                        xhr.responseType = 'blob';
                        xhr.onload = function (event) {
                            var blob = xhr.response;
                        };
                        xhr.open('GET', url);
                        xhr.send();
                        let index = "img" + i;
                        let a = '<a class="gallery-item" id="' + index + '"">' +
                            '<img src="' + url + '" alt="' + url + '" data-url="' + url + '"  style="width: 100%;height:100%;">' + '<span class="overlay">' +
                            '<h2></h2>' +
                            '<span></span>' + ' </span>' + '</a>';

                        $(".fh5co-gallery").append(a);
                        $("#img" + i).fadeOut(0);
                        console.log("parent data" + childData);
                        $("#img" + i).attr("parentOf", childSnapshot.key);
                        let j = i;
                        setTimeout(function () { $("#img" + j).fadeIn(3000); }, i * 750);
                        i++;

                    }).catch(function (error) {
                        // Handle any errors
                    });
                });
            });
        }
        $(document).ready(function () {

            $("#uploadImage").click(function () {
                $.FileDialog({
                    accept: "image/*",
                    cancelButton: "Cancel",
                    dragMessage: "Drop images here or click to choose manually.",
                    dropheight: 400,
                    errorMessage: "An error occured while loading file",
                    multiple: true,
                    okButton: "Upload",
                    readAs: "DataURL",
                    removeMessage: "Remove&nbsp;file",
                    title: "Load images"
                });
                $("input[type='file']").addClass("hidden");
                $(".bfd-dropfield-inner").html("Drop images here<br /><b>or</b><br />click here.");
                $(".bfd-dropfield-inner").css('padding-top', '110px');
                $(".modal-body").css('background-color', '#f0f0f0');
            });



            // handle files choice when done
            $(document).on('files.bs.filedialog', function (ev) {
                let files_list = ev.files;
                let rootRef = firebase.database().ref();
                let storageRef = firebase.storage().ref();
                for (i = 0; i < files_list.length; i++) {
                    let file = files_list[i];
                    let fileName = guid() + "_" + file.name;
                    let imageRef = storageRef
                        .child(fileName)
                        .put(file);
                    let imageObjectRef = rootRef.child(firebase.auth().currentUser.uid).child("images").push();
                    imageObjectRef.set({
                        fileName: fileName
                    });
                }
                loadList();
            });


            // handle dialog cancelling
            $(document).on('cancel.bs.filedialog', function (ev) {
                // DO SOMETHING when user cancelled
            });



            $(document).on('click', ".gallery-item", function () {
                if ($(this).hasClass("checked")) {
                    $(this).removeClass("checked");
                } else {
                    $(this).addClass("checked");
                    $('video').attr('poster', $(this).find("img").attr("src"))
                }
            });

        });

        function signUp() {
            var email = $("#email").val();
            var password = $("#password").val();
            console.log(email);
            console.log(password);
            firebase.auth().createUserWithEmailAndPassword(email, password).catch(function (error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // ...
            });
        }
        function signIn() {
            var email = $("#email").val();
            var password = $("#password").val();
            console.log(email);
            console.log(password);
            firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // ...
            });
        }

        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                // User is signed in.
                var displayName = user.displayName;
                var email = user.email;
                var emailVerified = user.emailVerified;
                var photoURL = user.photoURL;
                var isAnonymous = user.isAnonymous;
                var uid = user.uid;
                var providerData = user.providerData;
                console.log("signed in");
                console.log(password);
                document.getElementById("hello").innerHTML = "Hello " + email;
                $("#signIn").hide();
                $("#logged-in").show();
                $("#fh5co-gallery").show();
                $("#gallery").show();
                $("#uploadImage").show();
                loadList();
                // ...
            } else {
                $("#fh5co-gallery").hide();
                $("#gallery").hide();
                $("#signIn").show();
                $("#logged-in").hide();
                $("#uploadImage").hide();
            }
        });

        function signOut() {
            firebase.auth().signOut().then(function () {
                // Sign-out successful.
            }).catch(function (error) {
                // An error happened.
            });
        }

        function Delete() {
            var result = confirm("Want to delete?");
            if (result) {
                let rootRef = firebase.database().ref();
                $.each($(".checked"), function () {
                    imageParent = $(this).attr("parentOf");
                    rootRef.child(firebase.auth().currentUser.uid).child("images").child(imageParent).set(null).then(function () {
                        console.log("Document successfully deleted!");
                    }).catch(function (error) {
                        console.error("Error removing document: ", error);
                    });

                });
            }

        }

       

        function showPrev() {
            $("#fh5co-gallery").show();
            $("#gallery").show();
            $(document).ready(function () {
                $("#create").hide();
            });

        }

        function showPrev2() {
            $("#video").hide();
            $("#create").show();

        }

        function showNext() {
            var list = document.getElementsByClassName("checked");
            $("#fh5co-gallery").hide();
            $("#gallery").hide();
            if (list.length) {
                var list2 = [];
                $.each($(".checked"), function () {
                    list2.push($(this).find("img:first").attr('src'));
                });

                $(document).ready(function () {
                    $("#create").show();
                });
            } else {
                alert("No images selected");
            }

        }

        function loading(list) {
            $("body").append("<div id='loadingDiv' style='position:fixed;left:0px;top:0px;z-index:999999;width:100%;height:100%;text-align:center;background-color:rgba(0,0,0,0.7);font-size:55px;'><div style='position:fixed; top:40%; width:100%;color:white;' id='tempLink'>Loading...</div></div>");
            $.ajax({
                url: "http://imagestovideo.eirandanan.com//api/imagesToVideo",
                type: "post",
                data: {
                    imageUrls: list,
                    audioUrl: "https://firebasestorage.googleapis.com/v0/b/album-477f3.appspot.com/o/93bf2232-a6db-53d2-4233-8a093baefccb_shlomo.mp3?alt=media&token=973c1d4e-0292-408c-a16a-95659e525508"
                },
                //contentType: "application/json",
                //processData: false,
                success: function (videoUrl) {
                    console.log(videoUrl);
                    $("#tempLink").html("<a href='" + videoUrl + "' target='_blank'>Click Here To Open Video</a>");
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        function Create() {
            let file = document.querySelector("[name=file]").files;
            if (file.length) {
                file = document.querySelector("[name=file]").files[0];
                let rootRef = firebase.database().ref();
                let storageRef = firebase.storage().ref();
                let fileName = guid() + "_" + file.name;
                let imageRef = storageRef
                    .child(fileName)
                    .put(file);
                let imageObjectRef = rootRef.child(firebase.auth().currentUser.uid).child("songs").push();
                imageObjectRef.set({
                    fileName: fileName
                })

                imageRef2 = firebase.storage().ref().child(fileName);

                imageRef2.getDownloadURL().then(function (url) {
                    var xhr = new XMLHttpRequest();
                    xhr.responseType = 'blob';
                    xhr.onload = function (event) {
                        var blob = xhr.response;
                    };
                    xhr.open('GET', url);
                    xhr.send();
                    console.log(url);
                }).catch(function (error) {
                    // Handle any errors
                });


                $("#create").hide();
                $("#video").show();
                var songPath = document.querySelector("[name=file]").files["0"].name;
                console.log(songPath);
                $.each($(".checked"), function () {
                    console.log($(this).find("img:first").attr('src'));
                });
            } else {
                alert("No sound selected");
            }

        }


    </script>

</body>
</html>
